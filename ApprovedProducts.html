<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Eat Healthy!</title>
        <!-- stylesheets -->
        <link type="text/css" rel="stylesheet" href="stylesheets/bootstrap.min.css" />
        <link type="text/css" rel="stylesheet" href="stylesheets/DT_bootstrap.min.css" />
        <style>
        	.container {
        		width: 940px; 
        	}
        	.dataTables_scroll {
        		padding-bottom: 10px;
        	}
        	.list-row {
        		padding-top:30px;
        	}
        </style>
        <!-- scripts -->
        <script type="text/javascript" src="javascripts/jquery-1.8.3.min.js"></script>
        <script type="text/javascript" src="javascripts/bootstrap.min.js"></script>
        <script type="text/javascript" src="javascripts/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="javascripts/jquery.csv.min.js"></script>
        <script type="text/javascript" src="javascripts/DT_bootstrap.min.js"></script>
        <script type="text/javascript">

        	// on page load, get data from google and create our table
        	$(function() {

				// google spreadsheet urls where we can get the data
        		var vendingMachineUrl = 'https://docs.google.com/spreadsheet/pub?key=0AhgeWcbPrqvOdGNqckRxd2FieXhZZFVSU3JvM1hHYkE&single=true&gid=0&output=csv';
        		
        		var wholeGrainsUrl = 'https://docs.google.com/spreadsheet/pub?key=0AhgeWcbPrqvOdGgxbkJYdUVRVkJHSHFQNlVkUnJrN2c&single=true&gid=0&output=csv';

    			// make an ajax GET request to google
    			$.get(vendingMachineUrl, function (dataAsCsv) {

					// this gets run when the data comes back from google

					var table = $('#vendingMachinesDt'); // element that will hold our data table 
					var parsedData = $.csv()(dataAsCsv); // turn csv into javascript table (array of arrays)
					vendingMachinesHtmlTable(parsedData, table); // fill html table with our data
					vendingMachinesDataTable(table); // initialize datatable to allow sorting, searching, etc.

    			});

    			// make an ajax GET request to google
    			$.get(wholeGrainsUrl, function (dataAsCsv) {

					// this gets run when the data comes back from google

					var table = $('#wholeGrainsDt'); // element that will hold our data table 
					var parsedData = $.csv()(dataAsCsv); // turn csv into javascript table (array of arrays)
					wholeGrainsHtmlTable(parsedData, table); // fill html table with our data
					wholeGrainsDataTable(table); // initialize datatable to allow sorting, searching, etc.
					
    			});
        	});

        	// fill the html table with data
        	function vendingMachinesHtmlTable(dataAsTable, htmlTable) {

    			// find the head and body of our html table
				var thead = htmlTable.find('thead');
				var tbody = htmlTable.find('tbody');

				// loop through our data and stick it in the html table
        		$(dataAsTable).each(function (index, row) {

    				// we know the columns of our data because we control the google spreadsheet
					var foodType = row[0];
					var productName = row[1];
					var companyName = row[2];
					var distributorCode = row[3];
					var id = row[4];
					var size = row[5];
					var flavor = row[6];
					var type = row[7];
					var guidelinesGroup = row[8];

					// if index is 0, we're on the header row
					if (index == 0) {
						var htmlRow = '<tr>'
										+ '<th>' + foodType + '</th>'
										+ '<th>' + productName + '</th>'
										+ '<th>' + companyName + '</th>'
										+ '<th>' + distributorCode + '</th>'
									+ '</tr>';
						thead.append(htmlRow);
					} 
					else { // otherwise we're on the actual data
						var htmlRow = '<tr>'
										+ '<td>' + foodType + '</td>'
										+ '<td>' + productName + getSizeToDisplay(size) + '</td>'
										+ '<td>' + companyName + '</td>'
										+ '<td>' + distributorCode + '</td>'
									+ '</tr>';
						tbody.append(htmlRow);
					}
        		});
        	}

        	function wholeGrainsHtmlTable(dataAsTable, htmlTable) {

    			// find the head and body of our html table
				var thead = htmlTable.find('thead');
				var tbody = htmlTable.find('tbody');

				// loop through our data and stick it in the html table
        		$(dataAsTable).each(function (index, row) {

    				// we know the columns of our data because we control the google spreadsheet
					var foodType = row[0];
					var productName = row[1];
					var wholeGrainStatus = row[2];
					var companyName = row[3];
					var distributorCode = row[4];
					var id = row[5];
					var size = row[6];
					var flavor = row[7];

					// if index is 0, we're on the header row
					if (index == 0) {
						var htmlRow = '<tr>'
										+ '<th>' + foodType + '</th>'
										+ '<th>' + productName + '</th>'
										+ '<th>' + wholeGrainStatus + '</th>'
										+ '<th>' + companyName + '</th>'
										+ '<th>' + distributorCode + '</th>'
									+ '</tr>';
						thead.append(htmlRow);
					} 
					else { // otherwise we're on the actual data
						var htmlRow = '<tr>'
										+ '<td>' + foodType + '</td>'
										+ '<td>' + productName + getSizeToDisplay(size) + '</td>'
										+ '<td>' + wholeGrainStatus + '</td>'
										+ '<td>' + companyName + '</td>'
										+ '<td>' + distributorCode + '</td>'
									+ '</tr>';
						tbody.append(htmlRow);
					}
        		});
        	}

    		// prettify the 'Product Size' info
        	function getSizeToDisplay(size) {
				var trimmedSize = $.trim(size);
				return trimmedSize != '' && trimmedSize.indexOf('Not Specified') == -1
					? ' (' + trimmedSize + ')'
					: '';
        	}

			// turn html table into a datatable 
			function vendingMachinesDataTable(table) {

				table.dataTable({
					"sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>", // specifies location of datatable controls
					"sPaginationType": "bootstrap",
					"oLanguage": {
						"sLengthMenu": "_MENU_ records per page" // pagination display
					},
					"sScrollY": "370px",  // max height of results
					"iDisplayLength": 25, // initial results per page
					"aLengthMenu": [[25, 50, -1], [25, 50, "All"]], // select options for results per page
					"aoColumns": [ // columns specific info, like widths, searchability, visibility, etc.
						{ "sWidth": "15%" },
						{ "sWidth": "35%" },
						{ "sWidth": "25%" },
						{ "sWidth": "25%" },
				    ]
				});	
			}

			function wholeGrainsDataTable(table) {

				table.dataTable({
					"sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>", // specifies location of datatable controls
					"sPaginationType": "bootstrap",
					"oLanguage": {
						"sLengthMenu": "_MENU_ records per page" // pagination display
					},
					"sScrollY": "370px",  // max height of results
					"iDisplayLength": 25, // initial results per page
					"aLengthMenu": [[25, 50, -1], [25, 50, "All"]], // select options for results per page 
					"aoColumns": [ // columns specific info, like widths, searchability, visibility, etc.
						{ "sWidth": "15%" },
						{ "sWidth": "30%" },
						{ "sWidth": "15%" },
						{ "sWidth": "20%" },
						{ "sWidth": "20%" },
				    ]
				});	
			}

        </script>
    </head>
    <body>
        <div class="container">
        	<div class="row list-row">
        		<h3>Vending Machines</h3>
	        	<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="vendingMachinesDt">
					<thead></thead>
					<tbody></tbody>
				</table>
			</div>
        	<div class="row list-row">
        		<h3>Whole Grains</h3>
	        	<table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="wholeGrainsDt">
					<thead></thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</body>
</html>
